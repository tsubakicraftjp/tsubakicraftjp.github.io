---
layout: post
title:  "ドラカメと速度警告灯の作成記録まとめ"
date:   2018-03-18 12:00:00 +0900
author: Kazuo Tsubaki
categories: IT
---

[メインブログ](https://tsubakicraft.wordpress.com)にドラカメと速度警告灯の製作の記録を投稿しましたが、ブログから記事を拾うのが大変なのでまとめました。試行錯誤や右往左往の様子も含めて『ドラカメ』プロジェクトの全貌をお伝えできればと思います。
課題はたくさんあります。バイクの振動を拾うので綺麗に動画を撮影できないとか、市販のドライブレコーダーのように記録した動画にタイムスタンプやスピードを動画に重ねられていないとか。それでも多少でもモノづくりの参考になればという想いで、恥ずかしい部分も含めてすべてを公開しました。


速度警告灯をバイクに搭載した様子です。

![](https://tsubakicraft.files.wordpress.com/2018/03/img_9711.jpg?w=616)

ドラカメをバイクに搭載した様子です。

![](https://tsubakicraft.files.wordpress.com/2018/03/img_0005.jpg?w=616)


以下、関連記事の一覧です。


[マイコンスピードメーターを作ろうか](https://wp.me/p7Mkw3-1Fe)

最初は手元にあって遊んでいるAdafruitのBluefruit LE MicroというBluetoothチップ搭載のArduinoマイコンを使って、運行情報を表示部する端末を作ろうかなと思い立って始めました。運行情報を提供する側もマイコンを使おうという考えでした。平成30年2月8日の投稿です。

[マイコンスピードメーターの続き](https://wp.me/p7Mkw3-1Fo)

運行情報を提供する側のマイコンとしてIntel Curie搭載のArduinoマイコンを使おうと思って調べ始めました。

[マイコンスピードメーターの続き２](https://wp.me/p7Mkw3-1FX)

Bluefruit LE MicroのLiPoバッテリーとバッテリーチャージャーを取り付け、OLEDディスプレイにBLEで送信されてきたデータを表示するものを試作してみました。

[マイコンスピードメーターの続き３](https://wp.me/p7Mkw3-1G0)

Bluefruit LE MicroにSPI接続のTFTディスプレイを使ってデータを表示するものを試作。表示が遅くて使えないものでした。

[マイコンスピードメーターの続き３の補足](https://wp.me/p7Mkw3-1G3)

前の投稿で配線の記述を忘れていたので補足しました。

[マイコンスピードメーターの続き４](https://wp.me/p7Mkw3-1Gq)

Intel Curie搭載のArduinoマイコンがBLE Centralデバイスとして上手く動かなかったので、運行情報を提供する側をiPhoneに変更しました。
スマートフォンには様々なセンサーが搭載されていていますので、それらを利用するのも悪くないかなと思いました。

[マイコンスピードメーターの続き５](https://wp.me/p7Mkw3-1Gx)

iPhone側の地図アプリの開発を始めました。走行速度もGPSから取得します。

[マイコンスピードメーターの続き６](https://wp.me/p7Mkw3-1GD)

iPhone側の地図アプリ開発と続きです。ルート検索して地図上にポリラインを描くところまで。

[ひと段落ついたところでドライブレコーダー付きスピードメーターアプリを公開](https://wp.me/p7Mkw3-1Hb)

方向転換です。地図アプリ（ナビアプリ）でなくてドライブレコーダー風のアプリを作ることにしました。前方を撮影して記録するだけの簡単なドライブレコーダー機能にGPS速度計を合体させたようなものです。この辺からソースコードの公開を始めています。

[ドライブレコーダーのテスト](https://wp.me/p7Mkw3-1Hf)

ドライブレコーダー部のテストをするために自動車を走らせながら使ってみました。

[GPSスピードメーター（iPhoneアプリ）とマイコン速度警告灯](https://wp.me/p7Mkw3-1Hv)

Bluefruit LE MicroとiPhoneをBLE接続して動かしてみました。

[GPSスピードメーター&簡易ドライブレコーダーに再生機能を追加する](https://wp.me/p7Mkw3-1HA)

ドライブレコーダーに再生機能を追加しました。これ以前のバージョンでは撮影した動画はフォトアルバムに保存していましたが、別途ファイルとして保存して、ファイル一覧の表示と動画の再生機能を追加したものです。

[GPSスピードメーター&簡易ドライブレコーダーに再生機能を追加する（続き）](https://wp.me/p7Mkw3-1HC)

撮影した動画をAirDropを使って他のiPhoneやMacに転送できるようにしました。

[GPSスピードメーター&簡易ドライブレコーダーの動作試験](https://wp.me/p7Mkw3-1HG)

ドラカメをスクーターに搭載して走ってみました。

[GPSスピードメーター&簡易ドライブレコーダーにGPSロギング機能を追加](https://wp.me/p7Mkw3-1HK)

動画の記録と同時に走行履歴を記録するためにGPSロギング機能を追加しました。この時点では１分間隔で位置情報を記録していましたが、最終的には１０秒間隔にしています。

[今日もGPSスピードメーター&簡易ドライブレコーダーの試験](https://wp.me/p7Mkw3-1HQ)

動画撮影機能とGPSロギング機能をバイクに搭載してテストしました。

[GPSスピードメーター&簡易ドライブレコーダーの車載用ステーを作る](https://wp.me/p7Mkw3-1HT)

iPhone用の防水ケースに付属していた樹脂製ハンドルバークランプではiPhoneの揺れが大き過ぎたので、アルミのフラットバーとアルミのハンドルバークランプを使ってマウント用のステーを自作しました。

[GPSスピードメーター&簡易ドライブレコーダーの雨中走行テスト](https://wp.me/p7Mkw3-1HW)

防水ケースのテストのため雨の中を走行してみました。

[GPSスピードメーター&簡易ドライブレコーダーのマウントの振動抑止にゴムを使うも](https://wp.me/p7Mkw3-1HZ)

マウントステーの振動が激しいので、ステーの結合箇所にゴムを挟んでみましたが、良い効果が得られなかったという内容です。

[Koshianブレークアウトボード](https://wp.me/p7Mkw3-1Ib)

Bluefruit LE Microだとバイクの車載機器としては少し大きいので、Koshianを使うことにしました。以前、購入して放ったらかしにしていたKoshian用のブレクアウトボードがあったので、まずはKoshianをブレークアウトボードにハンダ付けしました。

[早速Koshianを載せた基盤を使ってみる](https://wp.me/p7Mkw3-1If)

iPhoneからKoshianを動かす簡単にテストプログラムを作ってブレイクアウトボードにハンダ付けしたKoshianのテストを行いました。
KoshianやKonashiを動かすためのObjective-Cで書かれたライブラリがユカイ工学さんから公開されていますが、それを使わずにCoreBluetoothを使いSwiftで実装しています。

[早速Koshianを載せた基盤を作ってみる 続き](https://wp.me/p7Mkw3-1Ih)

車載を考えて、３端子レギュレーターを使った降圧回路とLED回路の検討です。

[Koshian基盤を仕上げる](https://wp.me/p7Mkw3-1Il)

車載ようのKoshian基板を仕上げました。もっと小さく作れないことはありませんが、今回はまあまあ使えればいいかなという程度の大きさになりました。

[ドラカメのテスト〜ステーの防振ゴムを取り外す](https://wp.me/p7Mkw3-1In)

ドラカメ車載用のステーの防振ゴムの具合が良くなかったので、ゴムを取り外して再度走行テストを行いました。

[Koshian速度警告灯をケースに収める](https://wp.me/p7Mkw3-1Ip)

仕上げたKoshian基板を透明のプラスチックケースに収めました。電源ケーブルは余っていたUSBケーブルを切って基板にハンダ付けしています。

[ドラカメとKoshian速度警告灯を接続す](https://wp.me/p7Mkw3-1Ir)

ドラカメのプログラムを修正してKoshian基板と接続するようにしました。

[隼のお迎えとドラレコ＆速度警告灯のテスト](https://wp.me/p7Mkw3-1IZ)

ターゲットバイク（Suzuki GSX1300R 隼）が納車されたので、早速速度警告灯とドラカメを搭載して走行してみました。平成30年3月17日の投稿です。


気が向いたら多少の改良はするかもしれませんが、一応このプロジェクトはこれで終了です。
